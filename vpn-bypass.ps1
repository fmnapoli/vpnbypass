# Verificar se o script está sendo executado como administrador

if (-not ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    # Se não estiver sendo executado como administrador, reinicia o script com privilégios elevados
    Start-Process -FilePath pwsh -Verb RunAs -ArgumentList "-File $($MyInvocation.MyCommand.Path)" #-Wait
    exit
}

$VPN_BYPASSED_IPS = ""
$VPN_BYPASS_PUBLIC_IPS = "FALSE"
$VPN_DOMAINS_NOT_BYPASSED = ""
$VPN_NOT_BYPASSED_IPS = ""
$VPN_NOT_BYPASSED_IPS = $VPN_NOT_BYPASSED_IPS.Split(",")

# comando: whois -h whois.radb.net -- '-i origin AS13335' | grep -Eo "([0-9.]+){4}/[0-9]+" | cut -d '/' -f 1 | tr '\n' ',' | sed 's/,$/\n/'

$cloudFlareIPs = "144.172.83.0,162.158.213.0,172.68.104.0,173.245.49.0,162.158.56.0,172.68.38.0,172.68.201.0,172.68.74.0,172.69.227.0,172.68.91.0,172.69.102.0,172.69.198.0,172.68.223.0,162.247.241.0,172.68.179.0,172.68.206.0,172.70.101.0,172.68.113.0,172.70.139.0,172.70.103.0,172.70.148.0,172.70.138.0,185.221.85.0,172.68.114.0,172.70.150.0,172.70.107.0,172.70.149.0,192.0.54.0,192.0.55.0,192.0.62.0,192.0.63.0,172.70.154.0,172.70.181.0,172.70.182.0,172.70.159.0,172.70.193.0,172.70.224.0,5.149.0.0,5.149.7.0,194.126.144.0,5.149.6.0,5.149.1.0,5.149.4.0,5.149.5.0,172.70.197.0,172.70.62.0,162.251.82.0,172.70.116.0,172.71.87.0,104.29.21.0,104.29.24.0,104.29.27.0,104.29.39.0,104.29.25.0,104.29.22.0,104.29.23.0,104.29.33.0,104.29.38.0,104.29.26.0,136.228.140.0,136.228.141.0,136.228.144.0,136.228.142.0,136.228.143.0,136.228.132.0,136.228.132.0,136.228.133.0,136.228.134.0,136.228.135.0,136.228.136.0,172.71.0.0,104.29.34.0,104.29.30.0,161.156.141.0,52.117.179.0,172.70.226.0,172.71.161.0,172.68.162.0,172.68.80.0,141.11.71.0,172.71.224.0,172.68.142.0,172.68.191.0,172.71.228.0,172.71.163.0,172.69.105.0,172.68.161.0,172.69.242.0,172.99.23.0,172.69.228.0,172.69.205.0,172.68.177.0,104.29.28.0,172.69.240.0,172.68.249.0,150.129.217.0,191.96.81.0,216.74.124.0,104.234.65.0,104.234.224.0,104.29.20.0,172.68.105.0,172.68.105.0,104.234.189.0,172.69.81.0,156.252.2.0,93.119.106.0,89.46.0.0,190.93.240.0,190.93.244.0,197.234.240.0,197.234.240.0,197.234.241.0,197.234.242.0,197.234.243.0,156.252.2.0,141.101.68.0,141.101.69.0,188.114.100.0,188.114.104.0,188.114.106.0,188.114.107.0,188.114.108.0,185.122.2.0,185.122.3.0,185.122.0.0,185.122.1.0,141.101.64.0,188.114.96.0,185.212.144.0,141.101.64.0,141.101.65.0,141.101.66.0,141.101.67.0,141.101.70.0,141.101.71.0,141.101.72.0,141.101.73.0,141.101.74.0,141.101.75.0,141.101.76.0,141.101.78.0,141.101.112.0,141.101.112.0,141.101.114.0,141.101.120.0,188.114.100.0,188.114.101.0,188.114.102.0,188.114.103.0,188.114.106.0,188.114.111.0,188.114.110.0,188.114.109.0,188.114.108.0,141.101.100.0,141.101.104.0,141.101.105.0,141.101.106.0,141.101.107.0,141.101.108.0,141.101.109.0,141.101.110.0,141.101.82.0,141.101.83.0,141.101.84.0,141.101.85.0,141.101.94.0,141.101.95.0,141.101.96.0,141.101.97.0,141.101.98.0,141.101.99.0,188.114.96.0,188.114.97.0,188.114.98.0,188.114.99.0,91.234.214.0,185.238.228.0,195.242.122.0,185.221.86.0,185.221.85.0,185.146.172.0,185.7.190.0,141.101.90.0,141.11.71.0,141.101.92.0,141.101.93.0,141.101.86.0,141.101.87.0,185.146.173.0,141.101.100.0,191.96.81.0,93.119.106.0,80.94.90.0,45.141.214.0,203.159.80.0,89.46.0.0,103.31.4.0,103.55.34.0,103.73.124.0,103.193.76.0,103.21.244.0,103.31.4.0,103.31.4.0,103.31.5.0,103.31.6.0,103.31.6.0,103.31.7.0,103.22.200.0,103.22.200.0,103.22.203.0,103.81.228.0,103.73.84.0,103.73.84.0,103.73.85.0,103.172.110.0,103.22.202.0,103.22.200.0,103.22.201.0,1.0.0.0,1.1.1.0,150.129.217.0,162.158.56.0,172.68.104.0,172.69.14.0,173.245.49.0,208.95.168.0,208.95.169.0,208.95.170.0,208.95.171.0,172.71.87.0,172.68.142.0,190.93.240.0,172.69.226.0,172.68.130.0,103.31.4.0,23.227.38.0,162.251.82.0,198.217.251.0,65.110.63.0,66.235.200.0,8.6.112.0,8.6.144.0,8.6.145.0,8.6.146.0,8.9.230.0,8.9.231.0,8.10.148.0,8.14.199.0,8.14.201.0,8.14.202.0,8.14.203.0,8.14.204.0,8.17.205.0,8.17.206.0,8.17.207.0,8.18.50.0,8.18.113.0,8.18.194.0,8.18.195.0,8.18.196.0,8.19.8.0,8.19.10.0,8.20.100.0,8.20.101.0,8.20.103.0,8.20.122.0,8.20.123.0,8.20.124.0,8.20.125.0,8.20.126.0,8.20.127.0,8.20.253.0,8.21.8.0,8.21.9.0,8.21.10.0,8.21.11.0,8.21.12.0,8.21.13.0,8.21.110.0,8.21.111.0,8.21.238.0,8.21.239.0,8.23.139.0,8.23.240.0,8.24.87.0,8.24.242.0,8.24.243.0,8.24.244.0,8.25.96.0,8.25.97.0,8.25.98.0,8.25.249.0,8.26.176.0,8.26.180.0,8.26.182.0,8.27.64.0,8.27.66.0,8.27.67.0,8.27.68.0,8.27.69.0,8.27.70.0,8.27.79.0,8.28.20.0,8.28.82.0,8.28.126.0,8.28.127.0,8.28.213.0,8.29.105.0,8.29.109.0,8.29.228.0,8.29.230.0,8.29.231.0,8.30.234.0,8.31.2.0,8.31.160.0,8.31.161.0,8.31.163.0,8.31.167.0,8.34.68.0,8.34.69.0,8.34.70.0,8.34.71.0,8.34.146.0,8.34.200.0,8.34.201.0,8.34.202.0,8.35.57.0,8.35.58.0,8.35.59.0,8.35.149.0,8.35.211.0,8.35.216.0,8.36.216.0,8.36.217.0,8.36.218.0,8.36.219.0,8.36.220.0,8.37.41.0,8.37.43.0,8.38.147.0,8.38.148.0,8.38.149.0,8.38.172.0,8.39.6.0,8.39.18.0,8.39.125.0,8.39.126.0,8.39.127.0,8.39.201.0,8.39.202.0,8.39.203.0,8.39.204.0,8.39.205.0,8.39.206.0,8.39.207.0,8.39.212.0,8.39.213.0,8.39.214.0,8.39.215.0,8.40.26.0,8.40.27.0,8.40.28.0,8.40.29.0,8.40.30.0,8.40.31.0,8.40.107.0,8.40.111.0,8.40.140.0,8.41.5.0,8.41.6.0,8.41.7.0,8.41.36.0,8.41.37.0,8.41.39.0,8.42.51.0,8.42.52.0,8.42.54.0,8.42.55.0,8.42.161.0,8.42.164.0,8.42.172.0,8.42.245.0,8.43.121.0,8.43.122.0,8.43.123.0,8.43.224.0,8.43.225.0,8.43.226.0,8.44.0.0,8.44.1.0,8.44.2.0,8.44.3.0,8.44.6.0,8.44.58.0,8.44.59.0,8.44.60.0,8.44.61.0,8.44.62.0,8.44.63.0,8.45.41.0,8.45.42.0,8.45.43.0,8.45.44.0,8.45.45.0,8.45.46.0,8.45.47.0,8.45.97.0,8.45.100.0,8.45.101.0,8.45.102.0,8.45.108.0,8.45.111.0,8.45.144.0,8.45.145.0,8.45.146.0,8.45.147.0,8.45.151.0,8.46.113.0,8.46.114.0,8.46.115.0,8.46.116.0,8.46.117.0,8.46.118.0,8.46.119.0,8.47.9.0,8.47.12.0,8.47.13.0,8.47.14.0,8.47.15.0,8.47.69.0,8.47.71.0,8.48.130.0,8.48.132.0,8.48.133.0,8.48.134.0,12.221.133.0,23.227.37.0,23.227.38.0,23.227.60.0,50.87.0.0,50.87.8.0,50.87.9.0,50.87.10.0,50.87.11.0,50.87.12.0,50.87.13.0,50.87.14.0,50.87.15.0,50.87.16.0,50.87.24.0,50.87.25.0,50.87.26.0,50.87.27.0,50.87.28.0,50.87.29.0,50.87.30.0,50.87.31.0,50.87.69.0,50.87.248.0,66.235.200.0,66.235.200.0,76.76.2.0,76.76.10.0,104.16.0.0,104.16.0.0,104.16.16.0,104.16.32.0,104.16.48.0,104.16.64.0,104.16.80.0,104.16.96.0,104.16.112.0,104.16.128.0,104.16.144.0,104.16.160.0,104.16.176.0,104.16.192.0,104.16.208.0,104.16.224.0,104.16.240.0,104.17.0.0,104.17.16.0,104.17.32.0,104.17.48.0,104.17.64.0,104.17.80.0,104.17.96.0,104.17.112.0,104.17.128.0,104.17.144.0,104.17.160.0,104.17.176.0,104.17.192.0,104.17.208.0,104.17.224.0,104.17.240.0,104.18.0.0,104.18.16.0,104.18.32.0,104.18.32.0,104.18.32.0,104.18.33.0,104.18.34.0,104.18.35.0,104.18.36.0,104.18.37.0,104.18.38.0,104.18.39.0,104.18.40.0,104.18.41.0,104.18.42.0,104.18.43.0,104.18.44.0,104.18.45.0,104.18.46.0,104.18.47.0,104.18.48.0,104.18.48.0,104.18.48.0,104.18.49.0,104.18.50.0,104.18.51.0,104.18.52.0,104.18.53.0,104.18.54.0,104.18.55.0,104.18.56.0,104.18.56.0,104.18.57.0,104.18.58.0,104.18.59.0,104.18.60.0,104.18.61.0,104.18.62.0,104.18.63.0,104.18.64.0,104.18.80.0,104.18.96.0,104.18.112.0,104.18.128.0,104.18.144.0,104.18.160.0,104.18.176.0,104.18.192.0,104.18.208.0,104.18.224.0,104.18.240.0,104.19.0.0,104.19.16.0,104.19.32.0,104.19.48.0,104.19.64.0,104.19.80.0,104.19.96.0,104.19.112.0,104.19.128.0,104.19.144.0,104.19.160.0,104.19.176.0,104.19.192.0,104.19.208.0,104.19.224.0,104.19.240.0,104.20.0.0,104.20.16.0,104.20.32.0,104.20.48.0,104.20.64.0,104.20.80.0,104.20.96.0,104.20.112.0,104.20.128.0,104.20.144.0,104.20.160.0,104.20.176.0,104.20.192.0,104.20.208.0,104.20.224.0,104.20.240.0,104.21.0.0,104.21.0.0,104.21.16.0,104.21.32.0,104.21.32.0,104.21.48.0,104.21.64.0,104.21.64.0,104.21.80.0,104.21.96.0,104.21.96.0,104.21.112.0,104.21.192.0,104.21.192.0,104.21.208.0,104.21.224.0,104.22.0.0,104.22.16.0,104.22.32.0,104.22.48.0,104.22.64.0,104.23.96.0,104.23.112.0,104.23.128.0,104.23.192.0,104.23.240.0,104.24.0.0,104.24.16.0,104.24.32.0,104.24.48.0,104.24.64.0,104.24.80.0,104.24.96.0,104.24.96.0,104.24.96.0,104.24.104.0,104.24.112.0,104.24.128.0,104.24.144.0,104.24.160.0,104.24.176.0,104.24.192.0,104.24.208.0,104.24.224.0,104.24.240.0,104.25.0.0,104.25.0.0,104.25.16.0,104.25.32.0,104.25.48.0,104.25.64.0,104.25.80.0,104.25.96.0,104.25.112.0,104.25.128.0,104.25.128.0,104.25.144.0,104.25.160.0,104.25.176.0,104.25.192.0,104.25.208.0,104.25.224.0,104.25.240.0,104.26.0.0,104.27.0.0,104.27.16.0,104.27.32.0,104.27.32.0,104.27.40.0,104.27.48.0,104.27.64.0,104.27.80.0,104.27.96.0,104.27.112.0,104.27.128.0,104.27.128.0,104.27.128.0,104.27.136.0,104.27.144.0,104.27.160.0,104.27.160.0,104.27.176.0,104.27.192.0,104.27.208.0,104.27.240.0,104.28.0.0,104.28.0.0,104.28.0.0,104.28.1.0,104.28.2.0,104.28.3.0,104.28.4.0,104.28.6.0,104.28.16.0,104.28.16.0,104.28.24.0,104.28.32.0,104.28.32.0,104.28.48.0,104.28.64.0,104.28.64.0,104.28.80.0,104.28.96.0,104.28.96.0,104.28.112.0,104.28.128.0,104.28.128.0,104.28.144.0,104.28.160.0,104.28.160.0,104.28.176.0,104.28.192.0,104.28.192.0,104.28.192.0,104.28.193.0,104.28.194.0,104.28.195.0,104.28.196.0,104.28.197.0,104.28.198.0,104.28.199.0,104.28.200.0,104.28.201.0,104.28.202.0,104.28.203.0,104.28.204.0,104.28.205.0,104.28.206.0,104.28.207.0,104.28.208.0,104.28.208.0,104.28.209.0,104.28.210.0,104.28.211.0,104.28.212.0,104.28.213.0,104.28.214.0,104.28.215.0,104.28.216.0,104.28.217.0,104.28.218.0,104.28.219.0,104.28.220.0,104.28.221.0,104.28.222.0,104.28.223.0,104.28.224.0,104.28.224.0,104.28.224.0,104.28.225.0,104.28.226.0,104.28.227.0,104.28.228.0,104.28.229.0,104.28.230.0,104.28.231.0,104.28.232.0,104.28.233.0,104.28.234.0,104.28.235.0,104.28.236.0,104.28.237.0,104.28.238.0,104.28.239.0,104.28.240.0,104.28.240.0,104.28.241.0,104.28.242.0,104.28.243.0,104.28.244.0,104.28.245.0,104.28.246.0,104.28.247.0,104.28.248.0,104.28.249.0,104.28.250.0,104.28.251.0,104.28.252.0,104.28.253.0,104.28.254.0,104.28.255.0,104.29.0.0,104.29.1.0,104.29.2.0,104.29.3.0,104.29.4.0,104.29.5.0,104.29.6.0,104.29.7.0,104.29.8.0,104.29.9.0,104.29.11.0,104.29.12.0,104.29.13.0,104.29.14.0,104.29.15.0,104.29.16.0,104.29.17.0,104.29.18.0,104.29.19.0,104.29.20.0,104.29.21.0,104.29.22.0,104.29.23.0,104.29.24.0,104.29.25.0,104.29.26.0,104.29.27.0,104.29.28.0,104.29.29.0,104.29.30.0,104.29.31.0,104.29.32.0,104.29.33.0,104.29.34.0,104.29.35.0,104.29.36.0,104.29.37.0,104.29.38.0,104.29.39.0,104.29.40.0,104.29.41.0,104.29.42.0,104.29.43.0,104.29.44.0,104.29.45.0,104.29.46.0,104.29.47.0,104.29.48.0,104.29.49.0,104.29.50.0,104.29.51.0,104.29.52.0,104.29.53.0,104.29.54.0,104.29.55.0,104.29.56.0,104.29.57.0,104.29.58.0,104.29.59.0,104.29.60.0,104.29.61.0,104.29.62.0,104.29.63.0,104.29.64.0,104.29.65.0,104.29.66.0,104.29.67.0,104.29.68.0,104.29.69.0,104.29.70.0,104.29.71.0,104.29.72.0,104.29.73.0,104.29.76.0,104.29.77.0,104.29.78.0,104.29.79.0,104.29.80.0,104.29.81.0,104.29.82.0,104.29.83.0,104.29.84.0,104.29.85.0,104.29.86.0,104.29.87.0,104.29.88.0,104.29.90.0,104.29.91.0,104.29.92.0,104.29.93.0,104.29.94.0,104.29.95.0,104.29.96.0,104.29.97.0,104.29.98.0,104.29.99.0,104.29.100.0,104.29.101.0,104.29.102.0,104.29.103.0,104.29.104.0,104.29.105.0,104.29.106.0,104.29.107.0,104.30.0.0,104.30.1.0,104.30.2.0,104.30.3.0,104.30.4.0,104.30.5.0,104.30.16.0,104.30.32.0,104.30.48.0,104.31.0.0,104.31.0.0,104.31.16.0,104.31.64.0,104.31.64.0,104.31.80.0,104.31.96.0,104.31.112.0,104.31.112.0,104.31.128.0,104.31.128.0,104.31.128.0,104.31.144.0,104.31.160.0,104.31.160.0,104.31.176.0,104.31.192.0,104.31.192.0,104.31.208.0,104.31.224.0,104.31.224.0,104.31.240.0,108.162.192.0,108.162.192.0,108.162.192.0,108.162.192.0,108.162.192.0,108.162.192.0,108.162.193.0,108.162.194.0,108.162.194.0,108.162.195.0,108.162.196.0,108.162.196.0,108.162.196.0,108.162.197.0,108.162.198.0,108.162.198.0,108.162.199.0,108.162.200.0,108.162.200.0,108.162.200.0,108.162.200.0,108.162.201.0,108.162.202.0,108.162.202.0,108.162.203.0,108.162.204.0,108.162.204.0,108.162.204.0,108.162.205.0,108.162.206.0,108.162.206.0,108.162.207.0,108.162.208.0,108.162.209.0,108.162.210.0,108.162.211.0,108.162.212.0,108.162.213.0,108.162.214.0,108.162.215.0,108.162.216.0,108.162.217.0,108.162.218.0,108.162.219.0,108.162.220.0,108.162.221.0,108.162.222.0,108.162.223.0,108.162.224.0,108.162.225.0,108.162.226.0,108.162.227.0,108.162.228.0,108.162.229.0,108.162.230.0,108.162.231.0,108.162.232.0,108.162.233.0,108.162.234.0,108.162.235.0,108.162.236.0,108.162.237.0,108.162.238.0,108.162.239.0,108.162.240.0,108.162.241.0,108.162.242.0,108.162.243.0,108.162.244.0,108.162.245.0,108.162.246.0,108.162.247.0,108.162.248.0,108.162.249.0,108.162.250.0,108.162.251.0,108.162.252.0,108.162.253.0,108.162.255.0,162.158.0.0,162.158.0.0,162.158.0.0,162.158.0.0,162.158.2.0,162.158.4.0,162.158.4.0,162.158.5.0,162.158.6.0,162.158.7.0,162.158.8.0,162.158.9.0,162.158.10.0,162.158.11.0,162.158.12.0,162.158.12.0,162.158.12.0,162.158.14.0,162.158.16.0,162.158.16.0,162.158.17.0,162.158.18.0,162.158.19.0,162.158.20.0,162.158.20.0,162.158.20.0,162.158.21.0,162.158.22.0,162.158.22.0,162.158.23.0,162.158.24.0,162.158.24.0,162.158.25.0,162.158.26.0,162.158.27.0,162.158.28.0,162.158.29.0,162.158.30.0,162.158.31.0,162.158.32.0,162.158.32.0,162.158.33.0,162.158.34.0,162.158.35.0,162.158.36.0,162.158.37.0,162.158.38.0,162.158.39.0,162.158.40.0,162.158.41.0,162.158.42.0,162.158.43.0,162.158.44.0,162.158.44.0,162.158.45.0,162.158.46.0,162.158.47.0,162.158.48.0,162.158.48.0,162.158.49.0,162.158.50.0,162.158.51.0,162.158.52.0,162.158.52.0,162.158.53.0,162.158.54.0,162.158.55.0,162.158.56.0,162.158.56.0,162.158.56.0,162.158.57.0,162.158.58.0,162.158.58.0,162.158.59.0,162.158.60.0,162.158.60.0,162.158.61.0,162.158.62.0,162.158.63.0,162.158.68.0,162.158.70.0,162.158.72.0,162.158.72.0,162.158.73.0,162.158.74.0,162.158.75.0,162.158.76.0,162.158.76.0,162.158.76.0,162.158.77.0,162.158.78.0,162.158.78.0,162.158.80.0,162.158.80.0,162.158.81.0,162.158.82.0,162.158.82.0,162.158.83.0,162.158.84.0,162.158.84.0,162.158.85.0,162.158.86.0,162.158.87.0,162.158.88.0,162.158.88.0,162.158.89.0,162.158.90.0,162.158.91.0,162.158.92.0,162.158.93.0,162.158.94.0,162.158.95.0,162.158.96.0,162.158.96.0,162.158.97.0,162.158.98.0,162.158.99.0,162.158.100.0,162.158.101.0,162.158.102.0,162.158.103.0,162.158.104.0,162.158.105.0,162.158.106.0,162.158.107.0,162.158.108.0,162.158.108.0,162.158.110.0,162.158.111.0,162.158.112.0,162.158.113.0,162.158.114.0,162.158.115.0,162.158.116.0,162.158.116.0,162.158.117.0,162.158.118.0,162.158.119.0,162.158.120.0,162.158.121.0,162.158.122.0,162.158.123.0,162.158.124.0,162.158.128.0,162.158.132.0,162.158.132.0,162.158.133.0,162.158.134.0,162.158.135.0,162.158.136.0,162.158.136.0,162.158.136.0,162.158.138.0,162.158.140.0,162.158.140.0,162.158.141.0,162.158.142.0,162.158.143.0,162.158.144.0,162.158.144.0,162.158.145.0,162.158.146.0,162.158.147.0,162.158.148.0,162.158.148.0,162.158.149.0,162.158.150.0,162.158.150.0,162.158.151.0,162.158.152.0,162.158.152.0,162.158.153.0,162.158.154.0,162.158.155.0,162.158.156.0,162.158.156.0,162.158.157.0,162.158.158.0,162.158.159.0,162.158.160.0,162.158.160.0,162.158.161.0,162.158.162.0,162.158.163.0,162.158.168.0,162.158.169.0,162.158.170.0,162.158.171.0,162.158.176.0,162.158.176.0,162.158.177.0,162.158.178.0,162.158.179.0,162.158.180.0,162.158.180.0,162.158.181.0,162.158.182.0,162.158.183.0,162.158.184.0,162.158.184.0,162.158.185.0,162.158.186.0,162.158.187.0,162.158.188.0,162.158.188.0,162.158.189.0,162.158.190.0,162.158.191.0,162.158.192.0,162.158.193.0,162.158.194.0,162.158.195.0,162.158.196.0,162.158.197.0,162.158.198.0,162.158.199.0,162.158.200.0,162.158.204.0,162.158.206.0,162.158.206.0,162.158.207.0,162.158.208.0,162.158.212.0,162.158.215.0,162.158.216.0,162.158.216.0,162.158.217.0,162.158.218.0,162.158.218.0,162.158.220.0,162.158.224.0,162.158.224.0,162.158.225.0,162.158.226.0,162.158.228.0,162.158.228.0,162.158.228.0,162.158.230.0,162.158.232.0,162.158.232.0,162.158.234.0,162.158.236.0,162.158.240.0,162.158.244.0,162.158.244.0,162.158.248.0,162.158.248.0,162.158.250.0,162.158.252.0,162.158.252.0,162.158.253.0,162.158.254.0,162.158.255.0,162.159.0.0,162.159.0.0,162.159.0.0,162.159.0.0,162.159.0.0,162.159.1.0,162.159.2.0,162.159.3.0,162.159.4.0,162.159.5.0,162.159.6.0,162.159.7.0,162.159.8.0,162.159.9.0,162.159.10.0,162.159.11.0,162.159.12.0,162.159.13.0,162.159.14.0,162.159.15.0,162.159.16.0,162.159.16.0,162.159.17.0,162.159.18.0,162.159.19.0,162.159.20.0,162.159.21.0,162.159.22.0,162.159.23.0,162.159.24.0,162.159.25.0,162.159.26.0,162.159.27.0,162.159.28.0,162.159.29.0,162.159.30.0,162.159.31.0,162.159.32.0,162.159.32.0,162.159.34.0,162.159.36.0,162.159.40.0,162.159.42.0,162.159.46.0,162.159.48.0,162.159.58.0,162.159.60.0,162.159.64.0,162.159.128.0,162.159.128.0,162.159.132.0,162.159.160.0,162.159.160.0,162.159.192.0,162.159.192.0,162.159.192.0,162.159.193.0,162.159.194.0,162.159.195.0,162.159.196.0,162.159.196.0,162.159.200.0,162.159.200.0,162.159.201.0,162.159.204.0,162.159.204.0,162.159.205.0,162.159.208.0,162.159.212.0,162.159.216.0,162.159.224.0,162.159.224.0,162.159.240.0,162.247.241.0,162.247.242.0,167.88.51.0,172.64.0.0,172.64.0.0,172.64.0.0,172.64.0.0,172.64.16.0,172.64.32.0,172.64.32.0,172.64.33.0,172.64.34.0,172.64.35.0,172.64.36.0,172.64.38.0,172.64.40.0,172.64.48.0,172.64.52.0,172.64.53.0,172.64.64.0,172.64.68.0,172.64.69.0,172.64.80.0,172.64.96.0,172.64.112.0,172.64.128.0,172.64.144.0,172.64.144.0,172.64.145.0,172.64.146.0,172.64.147.0,172.64.148.0,172.64.149.0,172.64.150.0,172.64.151.0,172.64.152.0,172.64.153.0,172.64.154.0,172.64.155.0,172.64.156.0,172.64.157.0,172.64.158.0,172.64.159.0,172.64.160.0,172.64.176.0,172.64.176.0,172.64.177.0,172.64.178.0,172.64.179.0,172.64.180.0,172.64.181.0,172.64.182.0,172.64.183.0,172.64.192.0,172.64.208.0,172.64.224.0,172.64.228.0,172.64.229.0,172.64.232.0,172.64.233.0,172.64.234.0,172.64.235.0,172.64.236.0,172.64.237.0,172.64.238.0,172.64.239.0,172.64.240.0,172.65.0.0,172.65.0.0,172.65.0.0,172.65.16.0,172.65.32.0,172.65.32.0,172.65.48.0,172.65.64.0,172.65.80.0,172.65.96.0,172.65.112.0,172.65.128.0,172.65.144.0,172.65.160.0,172.65.176.0,172.65.192.0,172.65.208.0,172.65.224.0,172.65.240.0,172.66.0.0,172.66.0.0,172.66.40.0,172.67.0.0,172.67.0.0,172.67.16.0,172.67.32.0,172.67.48.0,172.67.64.0,172.67.80.0,172.67.96.0,172.67.112.0,172.67.128.0,172.67.144.0,172.67.160.0,172.67.176.0,172.67.192.0,172.67.208.0,172.67.224.0,172.67.240.0,172.68.0.0,172.68.0.0,172.68.0.0,172.68.4.0,172.68.4.0,172.68.4.0,172.68.5.0,172.68.6.0,172.68.8.0,172.68.12.0,172.68.16.0,172.68.16.0,172.68.16.0,172.68.16.0,172.68.17.0,172.68.24.0,172.68.28.0,172.68.28.0,172.68.29.0,172.68.30.0,172.68.31.0,172.68.32.0,172.68.32.0,172.68.34.0,172.68.36.0,172.68.38.0,172.68.39.0,172.68.40.0,172.68.44.0,172.68.44.0,172.68.45.0,172.68.46.0,172.68.46.0,172.68.47.0,172.68.48.0,172.68.48.0,172.68.50.0,172.68.52.0,172.68.56.0,172.68.57.0,172.68.58.0,172.68.59.0,172.68.60.0,172.68.60.0,172.68.62.0,172.68.64.0,172.68.64.0,172.68.66.0,172.68.68.0,172.68.72.0,172.68.72.0,172.68.74.0,172.68.75.0,172.68.76.0,172.68.76.0,172.68.78.0,172.68.78.0,172.68.79.0,172.68.80.0,172.68.80.0,172.68.81.0,172.68.83.0,172.68.84.0,172.68.88.0,172.68.89.0,172.68.90.0,172.68.90.0,172.68.91.0,172.68.92.0,172.68.92.0,172.68.92.0,172.68.93.0,172.68.94.0,172.68.94.0,172.68.95.0,172.68.96.0,172.68.97.0,172.68.98.0,172.68.99.0,172.68.100.0,172.68.104.0,172.68.104.0,172.68.104.0,172.68.106.0,172.68.108.0,172.68.108.0,172.68.109.0,172.68.110.0,172.68.111.0,172.68.112.0,172.68.112.0,172.68.113.0,172.68.114.0,172.68.114.0,172.68.115.0,172.68.116.0,172.68.116.0,172.68.117.0,172.68.118.0,172.68.119.0,172.68.120.0,172.68.120.0,172.68.123.0,172.68.124.0,172.68.124.0,172.68.126.0,172.68.127.0,172.68.128.0,172.68.128.0,172.68.128.0,172.68.129.0,172.68.130.0,172.68.130.0,172.68.131.0,172.68.132.0,172.68.132.0,172.68.133.0,172.68.134.0,172.68.135.0,172.68.136.0,172.68.140.0,172.68.140.0,172.68.141.0,172.68.142.0,172.68.143.0,172.68.144.0,172.68.144.0,172.68.146.0,172.68.148.0,172.68.152.0,172.68.152.0,172.68.153.0,172.68.154.0,172.68.155.0,172.68.156.0,172.68.160.0,172.68.160.0,172.68.161.0,172.68.162.0,172.68.163.0,172.68.164.0,172.68.164.0,172.68.166.0,172.68.168.0,172.68.168.0,172.68.168.0,172.68.169.0,172.68.170.0,172.68.170.0,172.68.171.0,172.68.172.0,172.68.176.0,172.68.176.0,172.68.177.0,172.68.178.0,172.68.179.0,172.68.180.0,172.68.180.0,172.68.182.0,172.68.184.0,172.68.188.0,172.68.188.0,172.68.189.0,172.68.190.0,172.68.191.0,172.68.192.0,172.68.196.0,172.68.196.0,172.68.198.0,172.68.200.0,172.68.200.0,172.68.201.0,172.68.202.0,172.68.203.0,172.68.204.0,172.68.206.0,172.68.207.0,172.68.208.0,172.68.208.0,172.68.210.0,172.68.212.0,172.68.212.0,172.68.214.0,172.68.216.0,172.68.216.0,172.68.217.0,172.68.218.0,172.68.219.0,172.68.220.0,172.68.220.0,172.68.222.0,172.68.223.0,172.68.224.0,172.68.228.0,172.68.228.0,172.68.230.0,172.68.231.0,172.68.232.0,172.68.236.0,172.68.240.0,172.68.244.0,172.68.244.0,172.68.246.0,172.68.248.0,172.68.248.0,172.68.248.0,172.68.249.0,172.68.250.0,172.68.251.0,172.68.252.0,172.68.252.0,172.68.253.0,172.68.254.0,172.68.255.0,172.69.0.0,172.69.0.0,172.69.0.0,172.69.2.0,172.69.2.0,172.69.3.0,172.69.4.0,172.69.4.0,172.69.6.0,172.69.8.0,172.69.12.0,172.69.12.0,172.69.13.0,172.69.14.0,172.69.15.0,172.69.16.0,172.69.16.0,172.69.16.0,172.69.17.0,172.69.18.0,172.69.19.0,172.69.20.0,172.69.20.0,172.69.21.0,172.69.22.0,172.69.23.0,172.69.32.0,172.69.33.0,172.69.34.0,172.69.35.0,172.69.36.0,172.69.38.0,172.69.40.0,172.69.40.0,172.69.44.0,172.69.44.0,172.69.45.0,172.69.46.0,172.69.47.0,172.69.48.0,172.69.48.0,172.69.52.0,172.69.52.0,172.69.53.0,172.69.54.0,172.69.55.0,172.69.56.0,172.69.56.0,172.69.57.0,172.69.58.0,172.69.59.0,172.69.60.0,172.69.64.0,172.69.64.0,172.69.64.0,172.69.65.0,172.69.66.0,172.69.67.0,172.69.68.0,172.69.68.0,172.69.69.0,172.69.70.0,172.69.71.0,172.69.72.0,172.69.76.0,172.69.76.0,172.69.78.0,172.69.79.0,172.69.80.0,172.69.84.0,172.69.84.0,172.69.88.0,172.69.92.0,172.69.92.0,172.69.96.0,172.69.96.0,172.69.97.0,172.69.100.0,172.69.100.0,172.69.102.0,172.69.103.0,172.69.104.0,172.69.104.0,172.69.105.0,172.69.106.0,172.69.107.0,172.69.108.0,172.69.108.0,172.69.110.0,172.69.110.0,172.69.111.0,172.69.112.0,172.69.116.0,172.69.120.0,172.69.124.0,172.69.124.0,172.69.126.0,172.69.128.0,172.69.132.0,172.69.132.0,172.69.134.0,172.69.136.0,172.69.140.0,172.69.144.0,172.69.148.0,172.69.152.0,172.69.152.0,172.69.153.0,172.69.154.0,172.69.155.0,172.69.156.0,172.69.156.0,172.69.157.0,172.69.158.0,172.69.159.0,172.69.160.0,172.69.160.0,172.69.161.0,172.69.162.0,172.69.163.0,172.69.164.0,172.69.168.0,172.69.172.0,172.69.172.0,172.69.176.0,172.69.180.0,172.69.180.0,172.69.181.0,172.69.182.0,172.69.183.0,172.69.184.0,172.69.184.0,172.69.186.0,172.69.188.0,172.69.192.0,172.69.196.0,172.69.196.0,172.69.197.0,172.69.198.0,172.69.199.0,172.69.200.0,172.69.204.0,172.69.204.0,172.69.205.0,172.69.208.0,172.69.208.0,172.69.210.0,172.69.211.0,172.69.212.0,172.69.212.0,172.69.213.0,172.69.216.0,172.69.216.0,172.69.217.0,172.69.218.0,172.69.219.0,172.69.220.0,172.69.220.0,172.69.221.0,172.69.224.0,172.69.224.0,172.69.226.0,172.69.226.0,172.69.227.0,172.69.228.0,172.69.228.0,172.69.232.0,172.69.232.0,172.69.232.0,172.69.233.0,172.69.234.0,172.69.235.0,172.69.236.0,172.69.236.0,172.69.237.0,172.69.238.0,172.69.239.0,172.69.240.0,172.69.240.0,172.69.241.0,172.69.242.0,172.69.244.0,172.69.244.0,172.69.246.0,172.69.248.0,172.69.248.0,172.69.249.0,172.69.250.0,172.69.251.0,172.69.252.0,172.69.252.0,172.69.253.0,172.69.254.0,172.69.255.0,172.70.0.0,172.70.32.0,172.70.33.0,172.70.34.0,172.70.35.0,172.70.36.0,172.70.37.0,172.70.38.0,172.70.39.0,172.70.40.0,172.70.41.0,172.70.42.0,172.70.43.0,172.70.44.0,172.70.45.0,172.70.47.0,172.70.48.0,172.70.49.0,172.70.50.0,172.70.51.0,172.70.52.0,172.70.53.0,172.70.54.0,172.70.55.0,172.70.56.0,172.70.57.0,172.70.58.0,172.70.59.0,172.70.60.0,172.70.61.0,172.70.62.0,172.70.63.0,172.70.80.0,172.70.81.0,172.70.82.0,172.70.83.0,172.70.92.0,172.70.93.0,172.70.95.0,172.70.96.0,172.70.96.0,172.70.97.0,172.70.98.0,172.70.99.0,172.70.100.0,172.70.101.0,172.70.102.0,172.70.103.0,172.70.104.0,172.70.105.0,172.70.106.0,172.70.108.0,172.70.109.0,172.70.110.0,172.70.111.0,172.70.112.0,172.70.113.0,172.70.114.0,172.70.115.0,172.70.116.0,172.70.117.0,172.70.118.0,172.70.119.0,172.70.120.0,172.70.121.0,172.70.122.0,172.70.123.0,172.70.132.0,172.70.133.0,172.70.134.0,172.70.135.0,172.70.136.0,172.70.137.0,172.70.138.0,172.70.139.0,172.70.140.0,172.70.141.0,172.70.142.0,172.70.143.0,172.70.144.0,172.70.145.0,172.70.146.0,172.70.147.0,172.70.148.0,172.70.150.0,172.70.151.0,172.70.152.0,172.70.153.0,172.70.154.0,172.70.156.0,172.70.157.0,172.70.158.0,172.70.159.0,172.70.172.0,172.70.173.0,172.70.174.0,172.70.175.0,172.70.180.0,172.70.181.0,172.70.183.0,172.70.184.0,172.70.185.0,172.70.186.0,172.70.187.0,172.70.190.0,172.70.191.0,172.70.192.0,172.70.193.0,172.70.194.0,172.70.195.0,172.70.196.0,172.70.197.0,172.70.198.0,172.70.199.0,172.70.200.0,172.70.201.0,172.70.202.0,172.70.203.0,172.70.204.0,172.70.205.0,172.70.206.0,172.70.207.0,172.70.208.0,172.70.209.0,172.70.210.0,172.70.211.0,172.70.212.0,172.70.213.0,172.70.214.0,172.70.215.0,172.70.216.0,172.70.217.0,172.70.218.0,172.70.219.0,172.70.220.0,172.70.221.0,172.70.222.0,172.70.223.0,172.70.224.0,172.70.225.0,172.70.226.0,172.70.227.0,172.70.228.0,172.70.229.0,172.70.230.0,172.70.231.0,172.70.232.0,172.70.233.0,172.70.234.0,172.70.235.0,172.70.236.0,172.70.237.0,172.70.238.0,172.70.239.0,172.70.240.0,172.70.241.0,172.70.242.0,172.70.243.0,172.70.244.0,172.70.245.0,172.70.246.0,172.70.247.0,172.70.248.0,172.70.249.0,172.70.250.0,172.70.251.0,172.70.252.0,172.70.253.0,172.70.254.0,172.70.255.0,172.71.0.0,172.71.0.0,172.71.1.0,172.71.2.0,172.71.3.0,172.71.4.0,172.71.5.0,172.71.6.0,172.71.7.0,172.71.8.0,172.71.9.0,172.71.10.0,172.71.11.0,172.71.12.0,172.71.13.0,172.71.14.0,172.71.15.0,172.71.16.0,172.71.17.0,172.71.20.0,172.71.21.0,172.71.22.0,172.71.23.0,172.71.24.0,172.71.25.0,172.71.26.0,172.71.27.0,172.71.28.0,172.71.29.0,172.71.30.0,172.71.31.0,172.71.80.0,172.71.81.0,172.71.82.0,172.71.83.0,172.71.84.0,172.71.85.0,172.71.86.0,172.71.87.0,172.71.88.0,172.71.89.0,172.71.90.0,172.71.92.0,172.71.93.0,172.71.94.0,172.71.95.0,172.71.96.0,172.71.97.0,172.71.98.0,172.71.99.0,172.71.100.0,172.71.101.0,172.71.102.0,172.71.103.0,172.71.108.0,172.71.109.0,172.71.110.0,172.71.111.0,172.71.112.0,172.71.113.0,172.71.114.0,172.71.115.0,172.71.116.0,172.71.117.0,172.71.118.0,172.71.119.0,172.71.120.0,172.71.121.0,172.71.122.0,172.71.123.0,172.71.124.0,172.71.125.0,172.71.126.0,172.71.127.0,172.71.128.0,172.71.129.0,172.71.130.0,172.71.131.0,172.71.132.0,172.71.133.0,172.71.134.0,172.71.135.0,172.71.137.0,172.71.138.0,172.71.139.0,172.71.140.0,172.71.141.0,172.71.142.0,172.71.143.0,172.71.144.0,172.71.145.0,172.71.146.0,172.71.147.0,172.71.148.0,172.71.149.0,172.71.150.0,172.71.151.0,172.71.152.0,172.71.153.0,172.71.154.0,172.71.155.0,172.71.156.0,172.71.157.0,172.71.158.0,172.71.159.0,172.71.160.0,172.71.161.0,172.71.162.0,172.71.163.0,172.71.164.0,172.71.165.0,172.71.166.0,172.71.167.0,172.71.168.0,172.71.169.0,172.71.170.0,172.71.171.0,172.71.172.0,172.71.173.0,172.71.174.0,172.71.175.0,172.71.176.0,172.71.177.0,172.71.178.0,172.71.179.0,172.71.180.0,172.71.181.0,172.71.182.0,172.71.183.0,172.71.184.0,172.71.185.0,172.71.186.0,172.71.187.0,172.71.188.0,172.71.189.0,172.71.190.0,172.71.191.0,172.71.192.0,172.71.193.0,172.71.194.0,172.71.195.0,172.71.196.0,172.71.197.0,172.71.198.0,172.71.199.0,172.71.200.0,172.71.201.0,172.71.202.0,172.71.203.0,172.71.204.0,172.71.205.0,172.71.206.0,172.71.207.0,172.71.208.0,172.71.209.0,172.71.210.0,172.71.211.0,172.71.212.0,172.71.213.0,172.71.214.0,172.71.215.0,172.71.216.0,172.71.217.0,172.71.218.0,172.71.219.0,172.71.220.0,172.71.221.0,172.71.222.0,172.71.223.0,172.71.224.0,172.71.225.0,172.71.226.0,172.71.227.0,172.71.228.0,172.71.229.0,172.71.230.0,172.71.231.0,172.71.232.0,172.71.233.0,172.71.234.0,172.71.235.0,172.71.236.0,172.71.237.0,172.71.238.0,172.71.239.0,172.71.240.0,172.71.241.0,172.71.242.0,172.71.243.0,172.71.244.0,172.71.245.0,172.71.246.0,172.71.247.0,172.71.248.0,172.71.249.0,172.71.250.0,172.71.251.0,172.71.252.0,172.71.253.0,172.71.254.0,172.71.255.0,173.245.48.0,173.245.48.0,173.245.49.0,173.245.50.0,173.245.51.0,173.245.52.0,173.245.53.0,173.245.54.0,173.245.55.0,173.245.56.0,173.245.57.0,173.245.58.0,173.245.58.0,173.245.59.0,173.245.60.0,173.245.61.0,173.245.62.0,173.245.62.0,173.245.63.0,198.41.128.0,198.41.128.0,198.41.128.0,198.41.128.0,198.41.128.0,198.41.128.0,198.41.128.0,198.41.128.0,198.41.129.0,198.41.130.0,198.41.130.0,198.41.131.0,198.41.132.0,198.41.136.0,198.41.136.0,198.41.136.0,198.41.137.0,198.41.138.0,198.41.138.0,198.41.139.0,198.41.140.0,198.41.140.0,198.41.140.0,198.41.141.0,198.41.142.0,198.41.142.0,198.41.143.0,198.41.144.0,198.41.144.0,198.41.144.0,198.41.144.0,198.41.144.0,198.41.145.0,198.41.146.0,198.41.146.0,198.41.147.0,198.41.148.0,198.41.148.0,198.41.148.0,198.41.149.0,198.41.150.0,198.41.150.0,198.41.151.0,198.41.152.0,198.41.152.0,198.41.152.0,198.41.153.0,198.41.154.0,198.41.154.0,198.41.155.0,198.41.156.0,198.41.156.0,198.41.156.0,198.41.157.0,198.41.158.0,198.41.158.0,198.41.159.0,198.41.160.0,198.41.160.0,198.41.161.0,198.41.162.0,198.41.163.0,198.41.164.0,198.41.165.0,198.41.166.0,198.41.167.0,198.41.168.0,198.41.169.0,198.41.170.0,198.41.171.0,198.41.172.0,198.41.173.0,198.41.174.0,198.41.175.0,198.41.176.0,198.41.176.0,198.41.176.0,198.41.176.0,198.41.177.0,198.41.178.0,198.41.178.0,198.41.179.0,198.41.180.0,198.41.180.0,198.41.180.0,198.41.181.0,198.41.182.0,198.41.182.0,198.41.183.0,198.41.184.0,198.41.184.0,198.41.184.0,198.41.184.0,198.41.185.0,198.41.186.0,198.41.186.0,198.41.187.0,198.41.188.0,198.41.188.0,198.41.188.0,198.41.189.0,198.41.190.0,198.41.190.0,198.41.191.0,198.41.192.0,198.41.192.0,198.41.192.0,198.41.192.0,198.41.192.0,198.41.192.0,198.41.192.0,198.41.193.0,198.41.194.0,198.41.194.0,198.41.195.0,198.41.196.0,198.41.196.0,198.41.196.0,198.41.197.0,198.41.198.0,198.41.198.0,198.41.199.0,198.41.200.0,198.41.200.0,198.41.200.0,198.41.200.0,198.41.201.0,198.41.202.0,198.41.202.0,198.41.203.0,198.41.204.0,198.41.204.0,198.41.204.0,198.41.205.0,198.41.206.0,198.41.206.0,198.41.207.0,198.41.208.0,198.41.208.0,198.41.208.0,198.41.208.0,198.41.208.0,198.41.209.0,198.41.210.0,198.41.210.0,198.41.211.0,198.41.212.0,198.41.212.0,198.41.212.0,198.41.213.0,198.41.214.0,198.41.214.0,198.41.215.0,198.41.216.0,198.41.216.0,198.41.216.0,198.41.216.0,198.41.217.0,198.41.218.0,198.41.218.0,198.41.219.0,198.41.220.0,198.41.220.0,198.41.220.0,198.41.221.0,198.41.222.0,198.41.222.0,198.41.223.0,198.41.224.0,198.41.224.0,198.41.224.0,198.41.224.0,198.41.225.0,198.41.226.0,198.41.226.0,198.41.227.0,198.41.228.0,198.41.228.0,198.41.229.0,198.41.230.0,198.41.231.0,198.41.232.0,198.41.232.0,198.41.233.0,198.41.234.0,198.41.235.0,198.41.236.0,198.41.236.0,198.41.236.0,198.41.237.0,198.41.238.0,198.41.238.0,198.41.239.0,198.41.240.0,198.41.241.0,198.41.242.0,198.41.243.0,198.41.244.0,198.41.245.0,198.41.250.0,198.41.251.0,198.41.252.0,198.41.252.0,198.41.253.0,199.27.128.0,199.27.128.0,199.27.132.0,199.27.134.0,172.69.80.0,172.69.85.0,172.69.72.0,172.64.72.0,172.64.73.0,172.64.74.0,172.64.75.0,172.64.76.0,172.69.184.0,172.69.173.0,172.69.124.0,172.69.93.0,172.69.73.0,162.158.13.0,104.29.108.0,162.158.229.0,172.68.105.0,172.69.81.0,104.234.65.0,172.69.206.0,172.69.207.0,172.69.214.0,172.69.215.0,104.29.110.0,172.68.106.0,172.68.107.0,104.234.224.0,172.69.230.0,172.69.176.0,172.69.177.0,172.69.178.0,172.69.179.0,104.29.109.0,172.69.82.0,172.69.83.0,172.69.86.0,172.69.87.0,104.29.113.0,172.69.74.0,172.69.75.0,172.69.94.0,172.69.95.0,104.29.112.0,104.234.189.0,162.158.14.0,162.158.15.0,162.158.138.0,162.158.139.0,104.29.111.0,172.69.231.0,172.69.185.0,172.69.186.0,172.69.187.0,172.69.222.0,172.69.223.0,104.29.114.0,172.69.144.0,172.69.188.0,172.69.148.0,172.69.149.0,172.69.150.0,172.69.151.0,172.68.40.0,172.68.41.0,172.69.145.0,172.68.42.0,172.68.43.0,104.29.115.0,172.68.0.0"
$cloudFlareIPs = $cloudFlareIPs.Split(",")

if (-not([string]::IsNullOrEmpty($env:VPN_BYPASSED_IPS))) {
    $sep = ","
    if (([string]::IsNullOrEmpty($VPN_BYPASSED_IPS))) {
        $sep = ""
    }    
    $VPN_BYPASSED_IPS = $VPN_BYPASSED_IPS + "$sep$env:VPN_BYPASSED_IPS"
}

if (-not([string]::IsNullOrEmpty($env:VPN_BYPASS_PUBLIC_IPS))) {
    $VPN_BYPASS_PUBLIC_IPS = $env:VPN_BYPASS_PUBLIC_IPS
}

if (-not([string]::IsNullOrEmpty($env:VPN_DOMAINS_NOT_BYPASSED))) {
    $sep = ","
    if (([string]::IsNullOrEmpty($VPN_DOMAINS_NOT_BYPASSED))) {
        $sep = ""
    }    
    $VPN_DOMAINS_NOT_BYPASSED = $VPN_DOMAINS_NOT_BYPASSED + "$sep$env:VPN_DOMAINS_NOT_BYPASSED"
}

$ErrorActionPreference = "SilentlyContinue"

function Get-InterfaceWithMostIPv4Routes {
    # Obtém todos os perfis de conexão
    $interfaces = Get-NetConnectionProfile | Select-Object -ExpandProperty InterfaceAlias

    # Obtém todas as rotas
    $routes = Get-NetRoute -AddressFamily IPv4

    # Agrupa as rotas por InterfaceAlias e conta o número de rotas por interface
    $routeCounts = $routes | Group-Object InterfaceAlias | Select-Object Count, Name

    # Filtra a lista de contagens de rotas para incluir apenas as interfaces que também estão presentes na saída do Get-NetConnectionProfile
    $filteredRouteCounts = $routeCounts | Where-Object { $interfaces -contains $_.Name }

    # Mostra na tela

    #$filteredRouteCounts | Format-Table -Property Name, Count -AutoSize

    # Obtém a interface com o maior número de rotas
    $maxRoutesInterface = $filteredRouteCounts | Sort-Object Count -Descending | Select-Object -First 1

    # Retorna a interface com o maior número de rotas
    return $maxRoutesInterface
}

function Get-VPNName {
    param (
        $interfaceAlias
    )

    $vpnName = "None"

    if ($interfaceAlias -match ("REMOTE_VPN_")) {
        return "BigIP"
    }

    if ($interfaceAlias -match ("CloudflareWARP")) {
        return "CloudflareWARP"
    }

    return $vpnName    
}

function Write-LogMessage {
    param (
        [Parameter(Mandatory = $true)]
        [string]$Message,
        [Parameter(Mandatory = $false)]
        [ValidateSet('DEBUG', 'INFO', 'WARNING', 'ERROR')]
        [string]$LogLevel = 'INFO'
    )

    $currentDate = Get-Date -Format "yyyy-MM-dd"
    $currentTime = Get-Date -Format "HH:mm:ss.fff"
    $logLine = "$currentDate $currentTime [$LogLevel] - $Message"
    Write-Output $logLine
}

function Get-BroadcastAddress {
   
    param
    (
        [Parameter(Mandatory = $true)]
        $IPAddress,
        $SubnetMask = '255.255.255.0'
    )

    filter Convert-IP2Decimal {
        ([IPAddress][String]([IPAddress]$_)).Address
    }


    filter Convert-Decimal2IP {
    ([System.Net.IPAddress]$_).IPAddressToString 
    }


    [UInt32]$ip = $IPAddress | Convert-IP2Decimal
    [UInt32]$subnet = $SubnetMask | Convert-IP2Decimal
    [UInt32]$broadcast = $ip -band $subnet 
    $broadcast -bor -bnot $subnet | Convert-Decimal2IP
}
function Convert-Subnetmask {
    [CmdLetBinding(DefaultParameterSetName = 'CIDR')]
    param( 
        [Parameter( 
            ParameterSetName = 'CIDR',       
            Position = 0,
            Mandatory = $true,
            HelpMessage = 'CIDR like /24 without "/"')]
        [ValidateRange(0, 32)]
        [Int32]$CIDR,

        [Parameter(
            ParameterSetName = 'Mask',
            Position = 0,
            Mandatory = $true,
            HelpMessage = 'Subnetmask like 255.255.255.0')]
        [ValidateScript({
                if ($_ -match "^(254|252|248|240|224|192|128).0.0.0$|^255.(254|252|248|240|224|192|128|0).0.0$|^255.255.(254|252|248|240|224|192|128|0).0$|^255.255.255.(255|254|252|248|240|224|192|128|0)$") {
                    return $true
                }
                else {
                    throw "Enter a valid subnetmask (like 255.255.255.0)!"    
                }
            })]
        [String]$Mask
    )

    Begin {

    }

    Process {
        switch ($PSCmdlet.ParameterSetName) {
            "CIDR" {                          
                # Make a string of bits (24 to 11111111111111111111111100000000)
                $CIDR_Bits = ('1' * $CIDR).PadRight(32, "0")
                
                # Split into groups of 8 bits, convert to Ints, join up into a string
                $Octets = $CIDR_Bits -split '(.{8})' -ne ''
                $Mask = ($Octets | ForEach-Object -Process { [Convert]::ToInt32($_, 2) }) -join '.'
            }

            "Mask" {
                # Convert the numbers into 8 bit blocks, join them all together, count the 1
                $Octets = $Mask.ToString().Split(".") | ForEach-Object -Process { [Convert]::ToString($_, 2) }
                $CIDR_Bits = ($Octets -join "").TrimEnd("0")

                # Count the "1" (111111111111111111111111 --> /24)                     
                $CIDR = $CIDR_Bits.Length             
            }               
        }

        [pscustomobject] @{
            Mask = $Mask
            CIDR = $CIDR
        }
    }

    End {
        
    }
}

function Get-InterfaceAlias {
    param (
        [Parameter(Mandatory = $true)]
        [string]$ProfileName
    )

    $connectionProfile = Get-NetConnectionProfile | Where-Object { $_.InterfaceAlias -match $ProfileName }

    if ($connectionProfile) {
        return $connectionProfile.InterfaceAlias
    }
    else {
        Write-LogMessage "Não foi possível encontrar o perfil de conexão com o nome '$ProfileName'."
    }
}

function Get-Interface {
    param (
        [string]$alias
    )
    
    return Get-NetIPConfiguration | Where-Object { $_.InterfaceAlias -eq $alias }
}

function Get-NetAddress {
    param (
        $ipaddress,
        $subnetmask
    )
    $ip = [ipaddress]$ipaddress
    $subnet = [ipaddress]$subnetmask
    $netid = [ipaddress]($ip.address -band $subnet.address)

    return $netid.ipaddresstostring
    
}
function Get-IPV4-Info {
    param (
        [string]$alias
    )

    $interface = Get-NetIPConfiguration $alias
    $IpAddress = $interface.IPv4Address.IPAddress
    $Mask = $(Convert-Subnetmask -CIDR $interface.IPv4Address.PrefixLength).Mask
    
    $IPV4Info = @{
        IpAddress        = $IpAddress
        Mask             = $Mask
        NetAddress       = Get-NetAddress $IpAddress $Mask
        BroadcastAddress = Get-BroadcastAddress $IpAddress $Mask
        IfaceId          = $interface.InterfaceIndex
        IfaceStatus      = $interface.NetAdapter.Status
    }
    return $IPV4Info    
}

function Get-NetworkAddresses {
  
    # Obtém a tabela de rotas
    $routes = Get-NetRoute 

    # Lista para armazenar os endereços de rede
    $networkAddresses = @()

    # Itera sobre cada rota e extrai o endereço de rede
    foreach ($route in $routes) {
        $networkAddresses += [string]($route.DestinationPrefix).Split("/")[0]
    }

    # Retorna a lista de endereços de rede
    return $networkAddresses
}


function Test-PrivateIP {
    param(
        [parameter(Mandatory, ValueFromPipeline)]
        [string]
        $IP
    )
    process {

        if ($IP -Match '(^127\.)|(^192\.168\.)|(^10\.)|(^172\.1[6-9]\.)|(^172\.2[0-9]\.)|(^172\.3[0-1]\.)') {
            $true
        }
        else {
            $false
        }
    }    
}

function Get-ResolvedIPs {
    param (
        [Parameter(Mandatory = $true)]
        [ValidateNotNullOrEmpty()]
        [string[]]$Urls
    )

    $resolvedIPs = @()

    foreach ($url in $Urls) {
        try {
            $resolved = Resolve-DnsName -Name $url -ErrorAction Stop
            $ip = $resolved.IPAddress
            $resolvedIPs += $ip
        }
        catch {
            Write-LogMessage -LogLevel ERROR -Message "Falhar ao resolver IP para URL: $url"
        }
    }

    return $resolvedIPs
}

function Get-PublicIPAddresses {
    param (
        [string[]] $Addresses
    )

    # Lista para armazenar os endereços IP públicos válidos
    $publicAddresses = @()

    foreach ($address in $Addresses) {
        $ip = [System.Net.IPAddress]::Parse($address)

        $isPrivateIP = $(Test-PrivateIP $address)
        $isIPv6 = $ip.AddressFamily -eq 'InterNetworkV6'
        $isLoopback = $address -eq '127.0.0.1'
        $isMulticast = $address -eq '224.0.0.0'
        $startsWithZero = $address.StartsWith("0.")
        $startsWith255 = $address.StartsWith("255.")

        # Verifica se o endereço IP é público, não é um endereço privado, não é IPv6,
        # não é loopback, não é broadcast e não termina com .0 ou .255
        if (!$isPrivateIP -and !$isIPv6 -and !$isLoopback -and !$isMulticast -and !$startsWithZero -and !$startsWith255) {
            $publicAddresses += $ip.ToString()
        }
    }

    # Retorna a lista de endereços IP públicos válidos
    return $publicAddresses
}

function Remove-PublicIPs {
    param (
        $ipAddress,
        $isCloudFlare=$false
    )

    $publicIPs = Get-PublicIPAddresses -Addresses $ipAddress

    foreach ($publicIP in $publicIPs) {        
        if ($publicIP -notin $VPN_NOT_BYPASSED_IPS ) {
            if ($isCloudFlare) {
                if ($publicIP -notin $cloudFlareIPs ) {
                    Write-LogMessage -Message "Removendo Rotas para $publicIP"
                    route delete $publicIP
                }
            }
            else {
                Write-LogMessage -Message "Removendo Rotas para $publicIP"
                route delete $publicIP
            }             
        }        
    }   
    
}
function Get-DefaultGateway {
    $routes = Get-NetRoute -AddressFamily IPv4
    $defaultRoute = $routes | Where-Object { $_.DestinationPrefix -eq '0.0.0.0/0' }
    
    if ($defaultRoute) {
        return $defaultRoute.NextHop
    }
    
    return $null
}
function Add-notBypassedPublicIPs {
    param (
        $notBypassedPublicIPs
    )
    foreach ($ipAddress in $notBypassedPublicIPs) {
        Write-LogMessage -Message "Adicionando o IP não Bypassed: $ipAddress"
        route ADD $ipAddress MASK 255.255.255.255 0.0.0.0 IF $vpn.IfaceId        
    }    
}


function ConfirmOrChangeVPNBypassSetting {
    # Obtém o valor atual da variável de ambiente
    $VPN_BYPASS_PUBLIC_IPS = [System.Environment]::GetEnvironmentVariable("VPN_BYPASS_PUBLIC_IPS", "Machine")

    if ([string]::IsNullOrEmpty($VPN_BYPASS_PUBLIC_IPS)) {
        [System.Environment]::SetEnvironmentVariable("VPN_BYPASS_PUBLIC_IPS", 'FALSE', "Machine")
        $VPN_BYPASS_PUBLIC_IPS = "FALSE"
    }

    # Imprime o valor atual
    Write-Host "O valor atual de VPN_BYPASS_PUBLIC_IPS é: $VPN_BYPASS_PUBLIC_IPS"

    # Pede ao usuário para confirmar o valor atual
    $userInput = Read-Host -Prompt 'Você deseja continuar com este valor? (S/N) [S]' 

    # Se o usuário não fornecer uma entrada (apertar Enter), considera como 'S'
    if ($userInput -eq '') {
        $userInput = 'S'
    }

    # Se o usuário responder com 'N' ou 'n', então muda o valor
    if ($userInput -eq 'N' -or $userInput -eq 'n') {
        # Troca o valor e salva na variável de ambiente
        if ($VPN_BYPASS_PUBLIC_IPS -eq 'TRUE') {
            [System.Environment]::SetEnvironmentVariable("VPN_BYPASS_PUBLIC_IPS", 'FALSE', "Machine")
        } else {
            [System.Environment]::SetEnvironmentVariable("VPN_BYPASS_PUBLIC_IPS", 'TRUE', "Machine")
        }

        Write-Host "O valor de VPN_BYPASS_PUBLIC_IPS foi alterado para: $([System.Environment]::GetEnvironmentVariable('VPN_BYPASS_PUBLIC_IPS', 'Machine'))"
    } else {
        Write-Host "O valor de VPN_BYPASS_PUBLIC_IPS não foi alterado."
    }
}



Write-LogMessage -Message "Coletando Informações das Interfaces..."

$defaultGateway = Get-DefaultGateway

$permitedList = $VPN_BYPASSED_IPS.Split(",")

$vpnInterfaceAlias =  $(Get-InterfaceWithMostIPv4Routes).name

$vpnName = Get-VPNName $vpnInterfaceAlias

$vpn = Get-IPV4-Info $vpnInterfaceAlias

$localEth = Get-IPV4-Info "Ethernet"
$localWifi = Get-IPV4-Info "Wi-Fi"
$wsl = Get-IPV4-Info "vEthernet (WSL)"

if ($localWifi.IfaceStatus -ne "Disconnected") {
    $local = $localWifi
}
else {
    $local = $localEth
}

$addresses = $(Get-NetworkAddresses) | Where-Object { $_.ifindex -ne $local.IfaceId }

$ipExterno = $(Invoke-WebRequest -Uri https://ifconfig.me/ip).Content

"2023-07-24 11:32:41.525 [INFO] - Coletando Informações das Interfaces..."
Write-Host ""
Write-Host "================================================================================"
Write-Host ""
Write-Host "VPN Ativa: $vpnName "
Write-Host "Endereço IP Externo: $ipExterno"
Write-Host "Endereço IP da Interface Local: $($local['IpAddress'])"
Write-Host "Endereço IP da Interface WSL: $($wsl['IpAddress'])"
Write-Host "Endereço IP da Interface VPN ($vpnName): $($vpn['IpAddress'])"
Write-Host "Gateway Padrão: $defaultGateway"
Write-Host ""
Write-Host "================================================================================"
Write-Host ""
Write-LogMessage -Message "Informações das Interfaces coletadas!"
Write-Host ""
Write-Host "================================================================================"

if ($vpnName -eq "None") {
    Write-Host ""
    Write-Host "================================================================================"
    Write-Host ""    
    Write-LogMessage -Message "Nenhuma VPN ativa!"
    Write-LogMessage -Message "Encerrando VPN ByPass..."
    Write-Host ""
    Write-Host "================================================================================"
    Write-Host ""        
    Start-Sleep 5
    Exit 0
}

Write-Host ""
ConfirmOrChangeVPNBypassSetting
Write-Host ""
Write-Host "================================================================================"
Write-Host ""
Write-LogMessage -Message "Coletando Configurações..."
Write-Host ""
Write-Host "================================================================================"
Write-Host ""
Write-Host "VPN_BYPASSED_IPS: $VPN_BYPASSED_IPS"
Write-Host "VPN_BYPASS_PUBLIC_IPS: $VPN_BYPASS_PUBLIC_IPS"
Write-Host "VPN_DOMAINS_NOT_BYPASSED: $VPN_DOMAINS_NOT_BYPASSED"
Write-Host "VPN_NOT_BYPASSED_IPS:$VPN_NOT_BYPASSED_IPS"
Write-Host ""
Write-Host "================================================================================"
Write-Host ""


$VPN_BYPASS_PUBLIC_IPS = [System.Environment]::GetEnvironmentVariable("VPN_BYPASS_PUBLIC_IPS", "Machine")

# Ajusta Rede Local

Write-LogMessage -Message "Ajuste de Rotas da Rede Local..."

if ($addresses -contains $local.NetAddress) {
    route delete $local.NetAddress 
    Write-LogMessage -Message "Rota $($local.NetAddress) Removida!"
}
route ADD $local.NetAddress MASK $local.Mask 0.0.0.0 METRIC 1 IF $local.IfaceId | Out-Null
Write-LogMessage -Message "Rota $($local.NetAddress) Adicionada!"

Write-LogMessage -Message "Rotas da Rede Local ajustadas!"


#Ajusta WSL

Write-LogMessage -Message "Ajuste de Rotas WSL..."

if ($addresses -contains $wsl.BroadcastAddress) {
    route delete $wsl.BroadcastAddress | Out-Null
    Write-LogMessage -Message "Rota $($wsl.BroadcastAddress) Removida!"
}

if ($addresses -contains $wsl.NetAddress) {
    route delete $wsl.NetAddress | Out-Null
    Write-LogMessage -Message "Rota $($wsl.NetAddress) Removida!"
}

if ($addresses -contains $wsl.IpAddress) {
    route delete $wsl.IpAddress | Out-Null
    Write-LogMessage -Message "Rota $($wsl.IpAddress) Removida!"
}

route ADD $wsl.BroadcastAddress MASK 255.255.255.255 0.0.0.0 IF $wsl.IfaceId 
Write-LogMessage -Message "Rota $($wsl.BroadcastAddress) Adicionada!"

route ADD $wsl.NetAddress MASK $wsl.Mask 0.0.0.0 IF $wsl.IfaceId 
Write-LogMessage -Message "Rota $($wsl.Mask) Adicionada!"

route ADD $wsl.IpAddress MASK 255.255.255.255 0.0.0.0 IF $wsl.IfaceId 
Write-LogMessage -Message "Rota $($wsl.IpAddress) Adicionada!"


Write-LogMessage -Message "Rotas WSL ajustadas!"

# Remover IPs Publicos 

$removePublicIPs = ($VPN_BYPASS_PUBLIC_IPS -eq "TRUE")

$isCloudFlare = ($vpnName -eq "CloudflareWARP")

if ($removePublicIPs) {   
    $VPN_DOMAINS_NOT_BYPASSED = $VPN_DOMAINS_NOT_BYPASSED.Split(",")
    Remove-PublicIPs -ipAddress $addresses -isCloudFlare $isCloudFlare 
    $addresses = $(Get-NetworkAddresses) | Where-Object { $_.ifindex -ne $local.IfaceId }
    $notBypassedPublicIPs = Get-ResolvedIPs -Urls $VPN_DOMAINS_NOT_BYPASSED    
    Add-notBypassedPublicIPs $notBypassedPublicIPs
}


Write-LogMessage -Message "Atualizando Rotas para IPs Permitidos..."


foreach ($ipAddress in $permitedList) {
    $ipAddressNotExists = [string]::IsNullOrEmpty($ipAddress)
    if ($ipAddressNotExists) {
        break
    }
    Write-LogMessage -Message "Atualizando Rota para $ipAddress"
    if ($addresses -contains $ipAddress) {
        route delete $ipAddress | Out-Null
        Write-LogMessage -Message "Rota $ipAddress Removida!"
    }    
    route ADD $ipAddress MASK 255.255.255.255 $defaultGateway METRIC 1 IF $local.IfaceId
    Write-LogMessage -Message "Rota $ipAddress Adicionada!"
}

Write-LogMessage -Message "Rotas para IPs Permitidos atualizadas!"

Write-LogMessage -Message "VPN Bypass finalizado!!!"

Start-Sleep 5


